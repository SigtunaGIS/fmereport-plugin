var Fmereport;(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};(()=>{e.d(t,{default:()=>o});const o=function({reportNames:e=["Report name 1"],reportUrls:t=["FME Flow URL with token parameter"]}={}){const o=Origo.ui.dom,n=new Origo.ol.source.Vector,r=new Origo.ol.layer.Vector({group:"none",name:"reportLayer",title:"reportLayer",source:n,zIndex:8,styleName:"origoStylefunction"});let i,d,a,l,m,c,s,g,p,u,h,y,I,f,E,v,w,B,x,b=!1,L=[],N=new Origo.ol.interaction.Draw({source:n,type:"Polygon"});const O=e=>{for(const t of x.category)for(const o of t.item)o.id!=e.srcElement.id&&o.id!=e.srcElement.parentNode.parentNode.id||!t.layerName||(origo.api().getLayer(t.layerName).setVisible(!0),d=JSON.parse(o.geometry),E.getView().setCenter(d),setTimeout((()=>{pixel=E.getPixelFromCoordinate(d),parameters={clusterFeatureinfoLevel:2,coordinate:d,hitTolerance:5,map:E,pixel},remoteParameters={coordinate:d,map:E,pixel};const e=Origo.getFeatureInfo.getFeaturesAtPixel(parameters,f);Origo.getFeatureInfo.getFeaturesFromRemote(remoteParameters,f).then((o=>{const n=(o||[]).concat(e).filter((e=>e.selectionGroup==t.layerName));n.length>0&&(origo.api().getFeatureinfo().render(n,"overlay",d,!1),E.getView().fit(n[0].feature.getGeometry().getExtent()))}))}),"150"))},C=e=>{const t=document.createElement("div");t.className="report-container";const o=document.createElement("div");o.className="category-header",o.textContent=e.name,t.appendChild(o);for(const o of e.item){t.appendChild(F(o));const e=k(o),n=T(o);t.appendChild(e),t.appendChild(n)}return t},k=e=>{const t=document.createElement("a");if(t.className="report-button",e.link){const o=M(e.icon);t.href=e.link,t.target="_blank",t.rel="noopener noreferrer",t.innerHTML=o.render()}return t},T=e=>{const t=document.createElement("div");if(t.className="report-button",e.geometry){const o=M();e.id=o.getId(),t.innerHTML=o.render()}return t},M=e=>Origo.ui.Button({cls:"o-fmereport padding-small icon-smaller round light box-shadow tooltip",tagName:"div",icon:e||"#fa-map-marker"}),F=e=>{const t=document.createElement("div");t.className="report-item-wrapper";const o=document.createElement("div");o.className="report-item-header",o.textContent=e.title,t.appendChild(o);const n=document.createElement("div");return n.className="report-item",n.innerHTML=e.description.replace(/\n/g,"<br>"),t.appendChild(n),t},P=e=>{"Point"!==e.feature.getGeometry().getType()&&(e=>{const t=e.feature.getGeometry().getType(),o=[];"Point"!==t&&(E.getInteractions().forEach((e=>{e instanceof Origo.ol.interaction.DoubleClickZoom&&o.push(e)})),o.length>0&&E.removeInteraction(o[0]))})(e)},H=e=>{const t={tool:"ReportGeometry",active:e};setTimeout((()=>{f.dispatch("toggleClickInteraction",t)}),100)},R=()=>{b?(G(),E.removeInteraction(N),N.setActive(!1),document.getElementById(B.getId()).classList.remove("active"),document.getElementById(B.getId()).classList.remove("hover"),H(!1),b=!1):(G(),document.getElementById(B.getId()).classList.add("active"),H(!0),E.addInteraction(N),N.setActive(!0),b=!0),N.on("drawstart",P,this),N.on("drawend",(e=>{w=e.feature.getGeometry().clone();let t=w.flatCoordinates;L=[];for(let e=0;e<t.length-2;e++)L.push(t[e]+":"+t[e+1]),e++;document.getElementById(B.getId()).classList.remove("active"),setTimeout((()=>{(()=>{const e=[];E.getInteractions().forEach((t=>{t instanceof Origo.ol.interaction.DoubleClickZoom&&e.push(t)})),e.length<1&&E.addInteraction(new Origo.ol.interaction.DoubleClickZoom)})()}),100),H(!1),E.removeInteraction(N),N.setActive(!1),b=!1}))},A=()=>{document.getElementById(p.getId()).classList.add("o-hidden"),document.getElementById(l.getId()).classList.remove("active"),document.getElementById(l.getId()).classList.add("tooltip"),document.getElementById(m.getId()).classList.add("o-hidden"),E&&N&&(E.removeInteraction(N),N.setActive(!1)),G()},G=()=>{n&&n.clear(),w="",L=[]},V=()=>{G(),document.getElementById(l.getId()).classList.contains("tooltip")?(document.getElementById(l.getId()).classList.add("active"),document.getElementById(l.getId()).classList.remove("tooltip"),document.getElementById(m.getId()).classList.remove("o-hidden"),(()=>{if(document.getElementsByClassName("o-search").length>0){const e=document.getElementsByClassName("o-search")[0],t=document.getElementById(c.getId());isOverlapping(e,t)?(document.getElementById(m.getId()).style.top="4rem",breakingWidth=window.innerWidth):window.innerWidth>breakingWidth&&(document.getElementById(m.getId()).style.top="1rem")}})()):A()};return Origo.ui.Component({name:"fmereport",onInit(){m=Origo.ui.Element({tagName:"div",cls:"flex column control box bg-white overflow-hidden o-hidden filter-box",style:{left:"4rem",top:"1rem",padding:"0.5rem",width:"15rem","z-index":"-1"}}),s=Origo.ui.Element({tagName:"select",cls:"width-100",style:{padding:"0.2rem","font-size":"0.8rem"},innerHTML:'<option value="">Välj rapport...</option>'}),g=Origo.ui.Element({tagName:"p",cls:"text-smaller",innerHTML:"Rapportverktyg:"}),h=Origo.ui.Button({cls:"small round margin-top-smaller margin-bottom-auto margin-right-small icon-smaller grey-lightest",icon:"#ic_close_24px",style:{float:"right"}}),B=Origo.ui.Button({cls:"grow light text-smaller box-shadow padding-left-large",text:"Polygon"}),y=Origo.ui.Button({cls:"grow light text-smaller box-shadow padding-left-large",text:"Rita en punkt"}),v=Origo.ui.Button({cls:"light rounded-large border text-smaller padding-right-large o-tooltip",text:"Skicka rapport",style:{padding:"0.4rem",width:"10rem","background-color":"#ebebeb"}}),c=Origo.ui.Element({tagName:"div",components:[g,B,y,s,v]}),u=Origo.ui.Element({tagName:"div",components:[h]}),p=Origo.ui.Element({tagName:"div",cls:"flex column control box bg-white overflow-hidden o-hidden filter-box draggable",style:{left:"4rem",top:"1rem",padding:"0.5rem","max-width":"30rem","overflow-x":"auto","overflow-y":"auto","z-index":"-1"}}),l=Origo.ui.Button({cls:"o-fmereport padding-small icon-smaller round light box-shadow tooltip",click(){V()},icon:"#fa-info-circle",tooltipText:"Ta fram en rapport",tooltipPlacement:"east"})},onAdd(o){f=o.target,I||(I=`${f.getMain().getMapTools().getId()}`),E=f.getMap(),E.addLayer(r),this.addComponents([l]),this.render(),(()=>{const o=document.getElementById(s.getId());e.forEach(((e,n)=>{const r=document.createElement("option");r.value=t[n],r.text=e,o.appendChild(r)}))})()},render(){document.getElementById(I).appendChild(o.html(l.render())),document.getElementById(f.getMain().getId()).appendChild(o.html(m.render())),document.getElementById(f.getMain().getId()).appendChild(o.html(p.render())),document.getElementById(m.getId()).appendChild(o.html(c.render())),document.getElementById(p.getId()).appendChild(o.html(u.render())),document.getElementById(v.getId()).addEventListener("click",(()=>(async()=>{if(0!==L.length)if(""!==document.getElementById(s.getId()).value){document.getElementById(m.getId()).classList.add("o-hidden"),document.body.style.cursor="wait";try{const e=await fetch(document.getElementById(s.getId()).value+"&PARAMETER="+L);if(!e.ok)throw new Error("Network response was not ok.");if(x=await e.json(),!(x&&x.category&&x.category.length>0))throw new Error("No data found within the area.");{for(const e of x.category)for(const t of e.item)t.id||(t.id=Math.random().toString(36).substr(2,9));i=(e=>{const t=document.createElement("div"),o=Origo.ui.Element({tagName:"div",cls:"report-header",innerHTML:e.title});t.innerHTML=o.render();for(const o of e.category)t.appendChild(C(o));return t.innerHTML})(x),a=Origo.ui.Element({tagName:"div",innerHTML:i});let e=document.getElementById(p.getId()).getElementsByTagName("div");e.length>1&&document.getElementById(p.getId()).removeChild(e[1]),document.getElementById(p.getId()).appendChild(o.html(a.render()));for(const e of x.category)for(const t of e.item)t.id&&t.geometry&&document.getElementById(t.id).addEventListener("click",O);document.getElementById(p.getId()).classList.remove("o-hidden")}}catch(e){console.error("Error fetching content:",e),Origo.ui.Modal({title:e.message.includes("No data")?"Resultat":"Fel vid anrop",content:e.message.includes("No data")?"Ingen information hittades inom området":"Något gick fel vid anrop, prova igen eller kontakta systemadministratör",target:f.getId()}),A()}finally{document.body.style.cursor="default"}}else window.alert("Ingen rapport vald");else window.alert("Ingen geometri ritad")})())),document.getElementById(h.getId()).addEventListener("click",(()=>A())),document.getElementById(B.getId()).addEventListener("click",(()=>R())),this.dispatch("render")}})}})(),Fmereport=t.default})();